<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-Squared - Professional Network</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <!-- Three.js for 3D Auth -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #7c3aed;
            --primary-dark: #6d28d9;
            --secondary: #059669;
            --accent: #d97706;
            --dark: #111827;
            --darker: #030712;
            --light: #f9fafb;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            overflow-x: hidden;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .gradient-text {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        .live-indicator {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .tiktok-video-container {
            scroll-snap-type: y mandatory;
            height: 100vh;
            overflow-y: scroll;
        }
        
        .tiktok-video {
            scroll-snap-align: start;
            height: 100vh;
        }
        
        .video-controls {
            position: absolute;
            right: 20px;
            bottom: 100px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }
        
        .control-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            color: white;
        }
        
        .control-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        
        /* 3D Auth Styles */
        #auth-3d-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            display: none;
        }
        
        .auth-modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 101;
            width: 90%;
            max-width: 400px;
        }
        
        /* Countdown Styles */
        .countdown-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .countdown-number {
            font-size: 4rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* AI Assistant */
        .ai-assistant {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 90;
        }
        
        .ai-chat {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 300px;
            height: 400px;
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .upload-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.upload-overlay:hover {
    opacity: 1;
}

.upload-label {
    cursor: pointer;
    transition: all 0.3s ease;
}

.upload-label:hover {
    background: rgba(255, 255, 255, 0.1);
}

.file-input {
    display: none;
}
    </style>
</head>
<body class="min-h-screen">
    <!-- Countdown to Launch -->
    <div id="countdown" class="countdown-container">
        <div class="text-center">
            <h1 class="text-5xl font-bold mb-4 gradient-text">M-Squared</h1>
            <p class="text-xl mb-8">Professional Network Launching In</p>
            <div class="flex space-x-4 justify-center">
                <div class="text-center">
                    <div id="days" class="countdown-number">00</div>
                    <div class="text-gray-400">Days</div>
                </div>
                <div class="text-center">
                    <div id="hours" class="countdown-number">00</div>
                    <div class="text-gray-400">Hours</div>
                </div>
                <div class="text-center">
                    <div id="minutes" class="countdown-number">00</div>
                    <div class="text-gray-400">Minutes</div>
                </div>
                <div class="text-center">
                    <div id="seconds" class="countdown-number">00</div>
                    <div class="text-gray-400">Seconds</div>
                </div>
            </div>
            <button id="skip-countdown" class="mt-8 bg-purple-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-purple-700 transition-colors">
                Enter Platform Now
            </button>
        </div>
    </div>

    <!-- 3D Auth Container -->
    <div id="auth-3d-container"></div>

    <!-- Main App -->
    <div id="root" style="display: none;"></div>

    <script type="text/babel">
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAnjLm6IqCXLiv8PaFwtLvCJZubMA1MjSE",
            authDomain: "m-squared-db23a.firebaseapp.com",
            projectId: "m-squared-db23a",
            storageBucket: "m-squared-db23a.firebasestorage.app",
            messagingSenderId: "G-D3WSS4K3HM",
            appId: "1:543566689329:web:cbc6ed8377777ec2ba9110"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // React Components
        const { useState, useEffect, useRef } = React;

        // Initialize 3D Authentication
        const init3DAuth = () => {
            const container = document.getElementById('auth-3d-container');
            container.style.display = 'block';
            
            // Create scene
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);
            
            // Add lights
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(5, 10, 7);
            scene.add(directionalLight);
            
            // Create floating geometric shapes
            const geometry = new THREE.IcosahedronGeometry(1, 0);
            const material = new THREE.MeshPhongMaterial({ 
                color: 0x7c3aed,
                shininess: 100,
                transparent: true,
                opacity: 0.8
            });
            
            const shapes = [];
            for (let i = 0; i < 15; i++) {
                const shape = new THREE.Mesh(geometry, material);
                shape.position.x = Math.random() * 20 - 10;
                shape.position.y = Math.random() * 20 - 10;
                shape.position.z = Math.random() * 20 - 10;
                shape.rotation.x = Math.random() * Math.PI;
                shape.rotation.y = Math.random() * Math.PI;
                shapes.push(shape);
                scene.add(shape);
            }
            
            camera.position.z = 15;
            
            // Add orbit controls
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // Create auth modal
            const authModal = document.createElement('div');
            authModal.className = 'auth-modal glass rounded-2xl p-8';
            authModal.innerHTML = `
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold gradient-text">Welcome to M-Squared</h2>
                    <p class="text-gray-400 mt-2">Professional Network</p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <input type="email" id="auth-email" placeholder="Email" class="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <input type="password" id="auth-password" placeholder="Password" class="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <button id="login-btn" class="w-full bg-gradient-to-r from-purple-600 to-purple-700 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300">
                        Sign In
                    </button>
                    <button id="signup-btn" class="w-full glass py-3 rounded-xl font-bold hover:bg-white/10 transition-colors">
                        Create Account
                    </button>
                    <div class="text-center text-gray-400 text-sm">
                        <a href="#" class="hover:text-purple-400" id="forgot-password">Forgot password?</a>
                    </div>
                </div>
                <div id="auth-message" class="mt-4 text-center text-sm"></div>
            `;
            container.appendChild(authModal);
            
            // Handle authentication
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            document.getElementById('signup-btn').addEventListener('click', handleSignUp);
            document.getElementById('forgot-password').addEventListener('click', handlePasswordReset);
            
            function handleLogin() {
                const email = document.getElementById('auth-email').value;
                const password = document.getElementById('auth-password').value;
                const messageEl = document.getElementById('auth-message');
                
                messageEl.textContent = "Signing in...";
                messageEl.className = "mt-4 text-center text-sm text-blue-400";
                
                auth.signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        messageEl.textContent = "Success! Redirecting...";
                        messageEl.className = "mt-4 text-center text-sm text-green-400";
                        setTimeout(() => {
                            container.style.display = 'none';
                            document.getElementById('root').style.display = 'block';
                        }, 1000);
                    })
                    .catch((error) => {
                        messageEl.textContent = error.message;
                        messageEl.className = "mt-4 text-center text-sm text-red-400";
                    });
            }
            
            function handleSignUp() {
                const email = document.getElementById('auth-email').value;
                const password = document.getElementById('auth-password').value;
                const messageEl = document.getElementById('auth-message');
                
                messageEl.textContent = "Creating account...";
                messageEl.className = "mt-4 text-center text-sm text-blue-400";
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Create user profile in Firestore
                        return db.collection('users').doc(userCredential.user.uid).set({
                            email: email,
                            name: email.split('@')[0],
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            profileComplete: false
                        });
                    })
                    .then(() => {
                        messageEl.textContent = "Account created! Redirecting...";
                        messageEl.className = "mt-4 text-center text-sm text-green-400";
                        setTimeout(() => {
                            container.style.display = 'none';
                            document.getElementById('root').style.display = 'block';
                        }, 1000);
                    })
                    .catch((error) => {
                        messageEl.textContent = error.message;
                        messageEl.className = "mt-4 text-center text-sm text-red-400";
                    });
            }
            
            function handlePasswordReset() {
                const email = document.getElementById('auth-email').value;
                const messageEl = document.getElementById('auth-message');
                
                if (!email) {
                    messageEl.textContent = "Please enter your email address";
                    messageEl.className = "mt-4 text-center text-sm text-red-400";
                    return;
                }
                
                messageEl.textContent = "Sending reset email...";
                messageEl.className = "mt-4 text-center text-sm text-blue-400";
                
                auth.sendPasswordResetEmail(email)
                    .then(() => {
                        messageEl.textContent = "Password reset email sent!";
                        messageEl.className = "mt-4 text-center text-sm text-green-400";
                    })
                    .catch((error) => {
                        messageEl.textContent = error.message;
                        messageEl.className = "mt-4 text-center text-sm text-red-400";
                    });
            }
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                
                shapes.forEach((shape, i) => {
                    shape.rotation.x += 0.01;
                    shape.rotation.y += 0.01;
                    shape.position.y += Math.sin(Date.now() * 0.001 + i) * 0.01;
                });
                
                controls.update();
                renderer.render(scene, camera);
            }
            
            animate();
            
            // Handle window resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        };

        // Countdown to Launch
        const initCountdown = () => {
            const countdownElement = document.getElementById('countdown');
            const daysElement = document.getElementById('days');
            const hoursElement = document.getElementById('hours');
            const minutesElement = document.getElementById('minutes');
            const secondsElement = document.getElementById('seconds');
            const skipButton = document.getElementById('skip-countdown');
            
            // Set launch date (7 days from now)
            const launchDate = new Date();
            launchDate.setDate(launchDate.getDate() + 7);
            
            function updateCountdown() {
                const now = new Date().getTime();
                const distance = launchDate - now;
                
                if (distance < 0) {
                    countdownElement.style.display = 'none';
                    init3DAuth();
                    return;
                }
                
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                
                daysElement.textContent = days.toString().padStart(2, '0');
                hoursElement.textContent = hours.toString().padStart(2, '0');
                minutesElement.textContent = minutes.toString().padStart(2, '0');
                secondsElement.textContent = seconds.toString().padStart(2, '0');
            }
            
            updateCountdown();
            const countdownInterval = setInterval(updateCountdown, 1000);
            
            skipButton.addEventListener('click', () => {
                clearInterval(countdownInterval);
                countdownElement.style.display = 'none';
                init3DAuth();
            });
        };

        // Start the countdown when page loads
        window.addEventListener('load', initCountdown);

        // Firebase Data Store
        
        const useDataStore = () => {
            const [user, setUser] = useState(null);
            const [videos, setVideos] = useState([]);
            const [liveStreams, setLiveStreams] = useState([]);
            const [professionals, setProfessionals] = useState([]);
            const [events, setEvents] = useState([]);
            const [posts, setPosts] = useState([]);
            const [products, setProducts] = useState([]);
            const [services, setServices] = useState([]);
            const [wallet, setWallet] = useState({ balance: 0, transactions: [] });
            const [loading, setLoading] = useState(true);

            // Listen for auth state changes
            useEffect(() => {
                const unsubscribe = auth.onAuthStateChanged(async (firebaseUser) => {
                    if (firebaseUser) {
                        // User is signed in
                        const userDoc = await db.collection('users').doc(firebaseUser.uid).get();
                        if (userDoc.exists) {
                            const userData = userDoc.data();
                            setUser({
                                id: firebaseUser.uid,
                                email: firebaseUser.email,
                                ...userData
                            });
                            
                            // Load user wallet
                            const walletDoc = await db.collection('wallets').doc(firebaseUser.uid).get();
                            if (walletDoc.exists) {
                                setWallet(walletDoc.data());
                            } else {
                                // Create wallet if doesn't exist
                                const newWallet = {
                                    balance: 0, // Starting balance
                                    transactions: [],
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                };
                                await db.collection('wallets').doc(firebaseUser.uid).set(newWallet);
                                setWallet(newWallet);
                            }
                        }
                    } else {
                        setUser(null);
                    }
                    setLoading(false);
                });

                return () => unsubscribe();
            }, []);

            // Load data from Firestore
            useEffect(() => {
                if (!user) return;

                // Load videos
                const videosUnsubscribe = db.collection('videos')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot(snapshot => {
                        const videosData = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setVideos(videosData);
                    });

                // Load live streams
                const liveStreamsUnsubscribe = db.collection('liveStreams')
                    .where('isLive', '==', true)
                    .onSnapshot(snapshot => {
                        const streamsData = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setLiveStreams(streamsData);
                    });

                // Load professionals
                const professionalsUnsubscribe = db.collection('users')
                    .where('profileComplete', '==', true)
                    .limit(20)
                    .onSnapshot(snapshot => {
                        const professionalsData = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setProfessionals(professionalsData);
                    });

                // Load events
                const eventsUnsubscribe = db.collection('events')
                    .orderBy('date', 'asc')
                    .onSnapshot(snapshot => {
                        const eventsData = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setEvents(eventsData);
                    });

                // Load posts
                const postsUnsubscribe = db.collection('posts')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot(snapshot => {
                        const postsData = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setPosts(postsData);
                    });

                // Load products
                const productsUnsubscribe = db.collection('products')
                    .where('available', '==', true)
                    .onSnapshot(snapshot => {
                        const productsData = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setProducts(productsData);
                    });

                // Load services
                const servicesUnsubscribe = db.collection('services')
                    .where('available', '==', true)
                    .onSnapshot(snapshot => {
                        const servicesData = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setServices(servicesData);
                    });

                return () => {
                    videosUnsubscribe();
                    liveStreamsUnsubscribe();
                    professionalsUnsubscribe();
                    eventsUnsubscribe();
                    postsUnsubscribe();
                    productsUnsubscribe();
                    servicesUnsubscribe();
                };
            }, [user]);

            // Firebase Functions
            const updateUserProfile = async (updates) => {
                if (!user) return;
                
                try {
                    await db.collection('users').doc(user.id).update({
                        ...updates,
                        profileComplete: true,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    setUser(prev => ({ ...prev, ...updates, profileComplete: true }));
                    return true;
                } catch (error) {
                    console.error("Error updating profile:", error);
                    return false;
                }
            };

            const toggleConnection = async (professionalId) => {
                if (!user) return;
                
                const connectionRef = db.collection('connections').doc(`${user.id}_${professionalId}`);
                const connectionDoc = await connectionRef.get();
                
                if (connectionDoc.exists) {
                    await connectionRef.delete();
                } else {
                    await connectionRef.set({
                        userId: user.id,
                        professionalId: professionalId,
                        connectedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            };

            const registerForEvent = async (eventId) => {
                if (!user) return;
                
                const registrationRef = db.collection('eventRegistrations').doc(`${user.id}_${eventId}`);
                const registrationDoc = await registrationRef.get();
                
                if (registrationDoc.exists) {
                    await registrationRef.delete();
                    return false; // Unregistered
                } else {
                    await registrationRef.set({
                        userId: user.id,
                        eventId: eventId,
                        registeredAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    return true; // Registered
                }
            };

            const addPost = async (content, mediaUrl = null) => {
                if (!user) return;
                
                try {
                    const postData = {
                        userId: user.id,
                        userName: user.name,
                        userAvatar: user.avatar,
                        userTitle: user.title,
                        content: content,
                        mediaUrl: mediaUrl,
                        likes: 0,
                        comments: 0,
                        shares: 0,
                        likedBy: [],
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await db.collection('posts').add(postData);
                    return true;
                } catch (error) {
                    console.error("Error adding post:", error);
                    return false;
                }
            };

            const likePost = async (postId, currentlyLiked) => {
                if (!user) return;
                
                const postRef = db.collection('posts').doc(postId);
                
                if (currentlyLiked) {
                    await postRef.update({
                        likes: firebase.firestore.FieldValue.increment(-1),
                        likedBy: firebase.firestore.FieldValue.arrayRemove(user.id)
                    });
                } else {
                    await postRef.update({
                        likes: firebase.firestore.FieldValue.increment(1),
                        likedBy: firebase.firestore.FieldValue.arrayUnion(user.id)
                    });
                }
            };

            const likeVideo = async (videoId, currentLikes) => {
                if (!user) return;
                
                await db.collection('videos').doc(videoId).update({
                    likes: currentLikes + 1,
                    likedBy: firebase.firestore.FieldValue.arrayUnion(user.id)
                });
            };

            const addComment = async (videoId, comment) => {
                if (!user) return;
                
                try {
                    const commentData = {
                        videoId: videoId,
                        userId: user.id,
                        userName: user.name,
                        userAvatar: user.avatar,
                        comment: comment,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await db.collection('comments').add(commentData);
                    
                    // Update video comment count
                    await db.collection('videos').doc(videoId).update({
                        comments: firebase.firestore.FieldValue.increment(1)
                    });
                    
                    return true;
                } catch (error) {
                    console.error("Error adding comment:", error);
                    return false;
                }
            };

            const createLiveStream = async (streamData) => {
                if (!user) return null;
                
                try {
                    const streamDoc = {
                        ...streamData,
                        userId: user.id,
                        userName: user.name,
                        userAvatar: user.avatar,
                        viewers: 0,
                        isLive: true,
                        chat: [],
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    const docRef = await db.collection('liveStreams').add(streamDoc);
                    return { id: docRef.id, ...streamDoc };
                } catch (error) {
                    console.error("Error creating live stream:", error);
                    return null;
                }
            };

            const addChatMessage = async (streamId, message) => {
                if (!user) return;
                
                try {
                    const messageData = {
                        streamId: streamId,
                        userId: user.id,
                        userName: user.name,
                        message: message,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    await db.collection('liveChats').add(messageData);
                } catch (error) {
                    console.error("Error adding chat message:", error);
                }
            };

            const purchaseProduct = async (productId, price) => {
                if (!user || wallet.balance < price) return false;
                
                try {
                    // Update wallet
                    const newBalance = wallet.balance - price;
                    await db.collection('wallets').doc(user.id).update({
                        balance: newBalance,
                        transactions: firebase.firestore.FieldValue.arrayUnion({
                            type: 'purchase',
                            amount: -price,
                            productId: productId,
                            date: firebase.firestore.FieldValue.serverTimestamp()
                        })
                    });
                    
                    setWallet(prev => ({
                        ...prev,
                        balance: newBalance,
                        transactions: [...prev.transactions, {
                            type: 'purchase',
                            amount: -price,
                            productId: productId,
                            date: new Date().toISOString()
                        }]
                    }));
                    
                    // Record purchase
                    await db.collection('purchases').add({
                        userId: user.id,
                        productId: productId,
                        price: price,
                        purchasedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    return true;
                } catch (error) {
                    console.error("Error purchasing product:", error);
                    return false;
                }
            };

            const purchaseService = async (serviceId, price) => {
                if (!user || wallet.balance < price) return false;
                
                try {
                    // Update wallet
                    const newBalance = wallet.balance - price;
                    await db.collection('wallets').doc(user.id).update({
                        balance: newBalance,
                        transactions: firebase.firestore.FieldValue.arrayUnion({
                            type: 'purchase',
                            amount: -price,
                            serviceId: serviceId,
                            date: firebase.firestore.FieldValue.serverTimestamp()
                        })
                    });
                    
                    setWallet(prev => ({
                        ...prev,
                        balance: newBalance,
                        transactions: [...prev.transactions, {
                            type: 'purchase',
                            amount: -price,
                            serviceId: serviceId,
                            date: new Date().toISOString()
                        }]
                    }));
                    
                    // Record purchase
                    await db.collection('serviceBookings').add({
                        userId: user.id,
                        serviceId: serviceId,
                        price: price,
                        status: 'booked',
                        bookedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    return true;
                } catch (error) {
                    console.error("Error purchasing service:", error);
                    return false;
                }
            };

            const addFunds = async (amount) => {
                if (!user) return false;
                
                try {
                    const newBalance = wallet.balance + amount;
                    await db.collection('wallets').doc(user.id).update({
                        balance: newBalance,
                        transactions: firebase.firestore.FieldValue.arrayUnion({
                            type: 'deposit',
                            amount: amount,
                            date: firebase.firestore.FieldValue.serverTimestamp()
                        })
                    });
                    
                    setWallet(prev => ({
                        ...prev,
                        balance: newBalance,
                        transactions: [...prev.transactions, {
                            type: 'deposit',
                            amount: amount,
                            date: new Date().toISOString()
                        }]
                    }));
                    
                    return true;
                } catch (error) {
                    console.error("Error adding funds:", error);
                    return false;
                }
            };

            const uploadMedia = async (file, path) => {
                try {
                    const storageRef = storage.ref();
                    const fileRef = storageRef.child(`${path}/${Date.now()}_${file.name}`);
                    const snapshot = await fileRef.put(file);
                    const downloadURL = await snapshot.ref.getDownloadURL();
                    return downloadURL;
                } catch (error) {
                    console.error("Error uploading media:", error);
                    return null;
                }
            };

            return {
                user,
                videos,
                liveStreams,
                professionals,
                events,
                posts,
                products,
                services,
                wallet,
                loading,
                updateUserProfile,
                toggleConnection,
                registerForEvent,
                addPost,
                likePost,
                likeVideo,
                addComment,
                createLiveStream,
                addChatMessage,
                purchaseProduct,
                purchaseService,
                addFunds,
                uploadMedia
            };
        };

        // TikTok-style Videos Tab with Upload Feature
const VideosTab = ({ videos, likeVideo, addComment, user, uploadMedia }) => {
    const [currentVideoIndex, setCurrentVideoIndex] = useState(0);
    const [showUploadModal, setShowUploadModal] = useState(false);
    const [uploading, setUploading] = useState(false);
    const [videoData, setVideoData] = useState({
        title: '',
        description: '',
        tags: []
    });
    const [selectedVideo, setSelectedVideo] = useState(null);
    const videoRefs = useRef([]);

    const handleScroll = (e) => {
        const container = e.target;
        const scrollTop = container.scrollTop;
        const videoHeight = container.clientHeight;
        const newIndex = Math.round(scrollTop / videoHeight);
        
        if (newIndex !== currentVideoIndex) {
            if (videoRefs.current[currentVideoIndex]) {
                videoRefs.current[currentVideoIndex].pause();
            }
            if (videoRefs.current[newIndex]) {
                videoRefs.current[newIndex].play();
            }
            setCurrentVideoIndex(newIndex);
        }
    };

    // ADD THIS FUNCTION - Video Upload
    const handleVideoUpload = async () => {
        if (!selectedVideo || !videoData.title.trim()) {
            alert("Please select a video and add a title");
            return;
        }

        setUploading(true);
        try {
            // Upload video to Firebase Storage
            const videoURL = await uploadMedia(selectedVideo, `videos/${user.id}`);
            
            if (videoURL) {
                // Save video data to Firestore
                await db.collection('videos').add({
                    userId: user.id,
                    userName: user.name,
                    userAvatar: user.avatar,
                    userTitle: user.title,
                    videoUrl: videoURL,
                    title: videoData.title,
                    description: videoData.description,
                    tags: videoData.tags,
                    likes: 0,
                    comments: 0,
                    shares: 0,
                    views: 0,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                alert("Video uploaded successfully!");
                setShowUploadModal(false);
                setVideoData({ title: '', description: '', tags: [] });
                setSelectedVideo(null);
            }
        } catch (error) {
            console.error("Error uploading video:", error);
            alert("Failed to upload video. Please try again.");
        }
        setUploading(false);
    };

    const handleLike = (video) => {
        if (!user) return;
        likeVideo(video.id, video.likes);
    };

    const handleComment = (videoId) => {
        if (!user) return;
        const comment = prompt("Add your comment:");
        if (comment) {
            addComment(videoId, comment);
        }
    };

    if (videos.length === 0) {
        return (
            <div className="tab-content active">
                <div className="flex flex-col items-center justify-center h-96">
                    <i className="fa-solid fa-video text-6xl text-gray-600 mb-4"></i>
                    <p className="text-gray-400 mb-4">No videos available yet</p>
                    {user && (
                        <button 
                            onClick={() => setShowUploadModal(true)}
                            className="bg-purple-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-purple-700 transition-colors"
                        >
                            <i className="fa-solid fa-upload mr-2"></i>
                            Upload Your First Video
                        </button>
                    )}
                </div>
            </div>
        );
    }

    return (
        <div className="tab-content active">
            {/* ADD THIS - Upload Button in Videos Tab */}
            {user && (
                <div className="container mx-auto px-6 py-4">
                    <button 
                        onClick={() => setShowUploadModal(true)}
                        className="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 flex items-center space-x-2"
                    >
                        <i className="fa-solid fa-upload"></i>
                        <span>Upload Video</span>
                    </button>
                </div>
            )}

            <div className="tiktok-video-container" onScroll={handleScroll}>
                {videos.map((video, index) => (
                    <div key={video.id} className="tiktok-video relative">
                        <video
                            ref={el => videoRefs.current[index] = el}
                            className="w-full h-full object-cover"
                            loop
                            muted
                            autoPlay={index === 0}
                        >
                            <source src={video.videoUrl} type="video/mp4" />
                        </video>
                        
                        <div className="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent">
                            <div className="flex items-start space-x-3 mb-4">
                                <img 
                                    src={video.userAvatar || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face"} 
                                    alt={video.userName}
                                    className="w-12 h-12 rounded-full"
                                />
                                <div className="flex-1">
                                    <h3 className="font-bold text-white">{video.userName}</h3>
                                    <p className="text-gray-300 text-sm">{video.userTitle}</p>
                                </div>
                                <button className="bg-purple-600 text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-purple-700">
                                    Follow
                                </button>
                            </div>
                            
                            <p className="text-white mb-2">{video.description}</p>
                            <div className="flex flex-wrap gap-2 mb-3">
                                {video.tags && video.tags.map((tag, idx) => (
                                    <span key={idx} className="text-purple-300 text-sm">#{tag}</span>
                                ))}
                            </div>
                        </div>

                        <div className="video-controls">
                            <div className="control-button">
                                <button 
                                    onClick={() => handleLike(video)}
                                    className="control-icon hover:scale-110 transition-transform"
                                >
                                    <i className="fa-solid fa-heart text-xl"></i>
                                </button>
                                <span className="text-sm">{video.likes || 0}</span>
                            </div>
                            
                            <div className="control-button">
                                <button 
                                    onClick={() => handleComment(video.id)}
                                    className="control-icon hover:scale-110 transition-transform"
                                >
                                    <i className="fa-solid fa-comment text-xl"></i>
                                </button>
                                <span className="text-sm">{video.comments || 0}</span>
                            </div>
                            
                            <div className="control-button">
                                <button className="control-icon hover:scale-110 transition-transform">
                                    <i className="fa-solid fa-share text-xl"></i>
                                </button>
                                <span className="text-sm">{video.shares || 0}</span>
                            </div>
                        </div>
                    </div>
                ))}
            </div>

            {/* ADD THIS - Video Upload Modal */}
            {showUploadModal && (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
                    <div className="glass-dark rounded-2xl p-6 w-full max-w-2xl go-live-modal">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-2xl font-bold gradient-text">Upload Video</h2>
                            <button 
                                onClick={() => setShowUploadModal(false)}
                                className="text-gray-400 hover:text-white"
                            >
                                <i className="fa-solid fa-times text-xl"></i>
                            </button>
                        </div>

                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium mb-2">Video Title</label>
                                <input
                                    type="text"
                                    value={videoData.title}
                                    onChange={(e) => setVideoData({...videoData, title: e.target.value})}
                                    placeholder="Enter video title"
                                    className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium mb-2">Description</label>
                                <textarea
                                    value={videoData.description}
                                    onChange={(e) => setVideoData({...videoData, description: e.target.value})}
                                    placeholder="Describe your video"
                                    rows="3"
                                    className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium mb-2">Tags (comma separated)</label>
                                <input
                                    type="text"
                                    value={videoData.tags.join(', ')}
                                    onChange={(e) => setVideoData({...videoData, tags: e.target.value.split(',').map(tag => tag.trim())})}
                                    placeholder="business, tips, tutorial"
                                    className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium mb-2">Select Video</label>
                                <label className="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-600 rounded-xl cursor-pointer hover:border-purple-500 transition-colors">
                                    <div className="flex flex-col items-center justify-center pt-5 pb-6">
                                        <i className="fa-solid fa-cloud-arrow-up text-2xl text-gray-400 mb-2"></i>
                                        <p className="text-sm text-gray-400">
                                            {selectedVideo ? selectedVideo.name : 'Click to upload video'}
                                        </p>
                                    </div>
                                    <input
                                        type="file"
                                        accept="video/*"
                                        onChange={(e) => setSelectedVideo(e.target.files[0])}
                                        className="hidden"
                                    />
                                </label>
                            </div>

                            <div className="flex space-x-4 pt-4">
                                <button 
                                    onClick={handleVideoUpload}
                                    disabled={uploading || !selectedVideo}
                                    className="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {uploading ? 'Uploading...' : 'Upload Video'}
                                </button>
                                <button 
                                    onClick={() => setShowUploadModal(false)}
                                    className="flex-1 glass py-3 rounded-xl font-bold hover:bg-white/10 transition-colors"
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};
        // Twitch-style Live Tab
        const LiveTab = ({ liveStreams, createLiveStream, user, addChatMessage }) => {
            const [showGoLiveModal, setShowGoLiveModal] = useState(false);
            const [selectedStream, setSelectedStream] = useState(null);
            const [streamData, setStreamData] = useState({
                title: '',
                category: 'Business',
                tags: []
            });
            const [newMessage, setNewMessage] = useState('');
            const [chatMessages, setChatMessages] = useState([]);

            // Load chat messages for selected stream
            useEffect(() => {
                if (!selectedStream) return;
                
                const unsubscribe = db.collection('liveChats')
                    .where('streamId', '==', selectedStream.id)
                    .orderBy('timestamp', 'asc')
                    .onSnapshot(snapshot => {
                        const messages = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        setChatMessages(messages);
                    });
                
                return () => unsubscribe();
            }, [selectedStream]);

            const handleGoLive = async () => {
                if (!streamData.title.trim()) {
                    alert("Please enter a stream title");
                    return;
                }
                
                const newStream = await createLiveStream({
                    title: streamData.title,
                    category: streamData.category,
                    tags: streamData.tags,
                    thumbnail: "https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=400&h=250&fit=crop"
                });
                
                if (newStream) {
                    setSelectedStream(newStream);
                    setShowGoLiveModal(false);
                    setStreamData({ title: '', category: 'Business', tags: [] });
                }
            };

            const handleSendMessage = () => {
                if (newMessage.trim() && selectedStream) {
                    addChatMessage(selectedStream.id, newMessage);
                    setNewMessage('');
                }
            };

            if (selectedStream) {
                return (
                    <div className="tab-content active fade-in">
                        <div className="container mx-auto px-6 py-8">
                            <button 
                                onClick={() => setSelectedStream(null)}
                                className="flex items-center space-x-2 text-purple-400 hover:text-purple-300 mb-6"
                            >
                                <i className="fa-solid fa-arrow-left"></i>
                                <span>Back to Live Streams</span>
                            </button>
                            
                            <div className="grid grid-cols-1 lg:grid-cols-4 gap-6">
                                <div className="lg:col-span-3">
                                    <div className="video-player glass-dark rounded-2xl overflow-hidden mb-4 bg-black">
                                        <div className="w-full h-full flex items-center justify-center">
                                            <div className="text-center">
                                                <i className="fa-solid fa-broadcast-tower text-6xl text-purple-500 mb-4"></i>
                                                <h3 className="text-2xl font-bold text-white">{selectedStream.title}</h3>
                                                <p className="text-gray-400">Live stream in progress</p>
                                            </div>
                                        </div>
                                        <div className="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center live-indicator">
                                            <span className="w-2 h-2 bg-white rounded-full mr-1"></span>
                                            LIVE
                                        </div>
                                        <div className="absolute bottom-4 left-4 text-white">
                                            <div className="flex items-center space-x-4">
                                                <span>{selectedStream.viewers || 0} viewers</span>
                                                <span>{selectedStream.userName}</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="glass-dark rounded-2xl p-4">
                                        <div className="flex items-center space-x-4 mb-4">
                                            <img 
                                                src={selectedStream.userAvatar || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face"} 
                                                alt={selectedStream.userName}
                                                className="w-12 h-12 rounded-full"
                                            />
                                            <div>
                                                <div className="font-bold">{selectedStream.userName}</div>
                                                <div className="text-gray-400">{selectedStream.userTitle}</div>
                                            </div>
                                            <button className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                                                Follow
                                            </button>
                                        </div>
                                        
                                        <div className="flex space-x-2 mb-4">
                                            {selectedStream.tags && selectedStream.tags.map(tag => (
                                                <span key={tag} className="glass px-3 py-1 rounded-full text-sm">
                                                    #{tag}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="lg:col-span-1">
                                    <div className="glass-dark rounded-2xl p-4 h-[600px] flex flex-col">
                                        <h3 className="font-bold mb-4">Live Chat</h3>
                                        <div className="flex-1 overflow-y-auto space-y-3 mb-4">
                                            {chatMessages.map(msg => (
                                                <div key={msg.id} className="chat-message">
                                                    <div className="flex items-start space-x-2">
                                                        <div className="w-6 h-6 rounded-full bg-purple-500 flex-shrink-0 flex items-center justify-center text-xs">
                                                            {msg.userName?.charAt(0) || 'U'}
                                                        </div>
                                                        <div className="flex-1">
                                                            <div className="flex items-center space-x-2">
                                                                <span className="font-bold text-sm">{msg.userName}</span>
                                                                <span className="text-gray-400 text-xs">
                                                                    {msg.timestamp?.toDate?.().toLocaleTimeString() || 'just now'}
                                                                </span>
                                                            </div>
                                                            <p className="text-sm">{msg.message}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                        <div className="flex space-x-2">
                                            <input
                                                type="text"
                                                value={newMessage}
                                                onChange={(e) => setNewMessage(e.target.value)}
                                                onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                                                placeholder="Send a message..."
                                                className="flex-1 glass rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                            <button 
                                                onClick={handleSendMessage}
                                                className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                                            >
                                                Send
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="tab-content active fade-in">
                    <div className="container mx-auto px-6 py-8">
                        <div className="flex items-center justify-between mb-8">
                            <h2 className="text-3xl font-bold">Live Business Streams</h2>
                            {user && (
                                <button 
                                    onClick={() => setShowGoLiveModal(true)}
                                    className="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 flex items-center space-x-2"
                                >
                                    <i className="fa-solid fa-broadcast-tower"></i>
                                    <span>Go Live</span>
                                </button>
                            )}
                        </div>
                        
                        {liveStreams.length === 0 ? (
                            <div className="text-center py-12">
                                <i className="fa-solid fa-broadcast-tower text-6xl text-gray-600 mb-4"></i>
                                <p className="text-gray-400">No live streams at the moment</p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {liveStreams.map(stream => (
                                    <div 
                                        key={stream.id}
                                        className="glass-dark rounded-2xl overflow-hidden card-hover group cursor-pointer"
                                        onClick={() => setSelectedStream(stream)}
                                    >
                                        <div className="relative">
                                            <img 
                                                src={stream.thumbnail} 
                                                alt={stream.title}
                                                className="w-full h-48 object-cover group-hover:scale-110 transition-transform duration-300"
                                            />
                                            <div className="absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-bold flex items-center live-indicator">
                                                <span className="w-2 h-2 bg-white rounded-full mr-1"></span>
                                                LIVE
                                            </div>
                                            <div className="absolute bottom-4 left-4 text-white">
                                                <h3 className="font-bold">{stream.title}</h3>
                                                <div className="flex items-center space-x-4 text-sm">
                                                    <span>{stream.viewers || 0} viewers</span>
                                                    <span>{stream.userName}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="p-4">
                                            <div className="flex items-center space-x-3">
                                                <img 
                                                    src={stream.userAvatar || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face"} 
                                                    alt={stream.userName}
                                                    className="w-8 h-8 rounded-full"
                                                />
                                                <div>
                                                    <div className="font-medium">{stream.userName}</div>
                                                    <div className="text-gray-400 text-sm">{stream.userTitle}</div>
                                                </div>
                                            </div>
                                            <div className="flex space-x-2 mt-3">
                                                {stream.tags && stream.tags.slice(0, 2).map(tag => (
                                                    <span key={tag} className="text-xs glass px-2 py-1 rounded">
                                                        #{tag}
                                                    </span>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Go Live Modal */}
                        {showGoLiveModal && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
                                <div className="glass-dark rounded-2xl p-6 w-full max-w-2xl go-live-modal">
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className="text-2xl font-bold gradient-text">Go Live</h2>
                                        <button 
                                            onClick={() => setShowGoLiveModal(false)}
                                            className="text-gray-400 hover:text-white"
                                        >
                                            <i className="fa-solid fa-times text-xl"></i>
                                        </button>
                                    </div>

                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Stream Title</label>
                                            <input
                                                type="text"
                                                value={streamData.title}
                                                onChange={(e) => setStreamData({...streamData, title: e.target.value})}
                                                placeholder="What are you streaming about?"
                                                className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-2">Category</label>
                                            <select
                                                value={streamData.category}
                                                onChange={(e) => setStreamData({...streamData, category: e.target.value})}
                                                className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            >
                                                <option value="Business">Business</option>
                                                <option value="Technology">Technology</option>
                                                <option value="Finance">Finance</option>
                                                <option value="Leadership">Leadership</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium mb-2">Tags (comma separated)</label>
                                            <input
                                                type="text"
                                                value={streamData.tags.join(', ')}
                                                onChange={(e) => setStreamData({...streamData, tags: e.target.value.split(',').map(tag => tag.trim())})}
                                                placeholder="business, strategy, leadership"
                                                className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                        </div>

                                        <div className="flex space-x-4 pt-4">
                                            <button 
                                                onClick={handleGoLive}
                                                className="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300"
                                            >
                                                Start Streaming
                                            </button>
                                            <button 
                                                onClick={() => setShowGoLiveModal(false)}
                                                className="flex-1 glass py-3 rounded-xl font-bold hover:bg-white/10 transition-colors"
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // LinkedIn-style Network Tab
        const NetworkTab = ({ professionals, toggleConnection, user }) => {
            const [searchTerm, setSearchTerm] = useState('');
            const [filterIndustry, setFilterIndustry] = useState('All');

            const industries = ['Tech', 'Finance', 'Consulting', 'Healthcare', 'Education', 'Wholeseller', 'Retailer', 'Street-vendor',];

            const filteredProfessionals = professionals.filter(professional => {
                const matchesSearch = professional.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    professional.title?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    professional.company?.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesIndustry = filterIndustry === 'All' || professional.industry === filterIndustry;
                
                return matchesSearch && matchesIndustry;
            });

            return (
                <div className="tab-content active fade-in">
                    <div className="container mx-auto px-6 py-8">
                        <div className="flex flex-col lg:flex-row gap-8">
                            <div className="lg:w-3/4">
                                <div className="glass-dark rounded-2xl p-6 mb-6">
                                    <h2 className="text-2xl font-bold mb-6">Find Professionals</h2>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                        <div>
                                            <input
                                                type="text"
                                                value={searchTerm}
                                                onChange={(e) => setSearchTerm(e.target.value)}
                                                placeholder="Search by name, title, or company"
                                                className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                        </div>
                                        <div>
                                            <select
                                                value={filterIndustry}
                                                onChange={(e) => setFilterIndustry(e.target.value)}
                                                className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            >
                                                {industries.map(industry => (
                                                    <option key={industry} value={industry}>{industry}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                    
                                    {filteredProfessionals.length === 0 ? (
                                        <div className="text-center py-12">
                                            <i className="fa-solid fa-users text-6xl text-gray-600 mb-4"></i>
                                            <p className="text-gray-400">No professionals found</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-6">
                                            {filteredProfessionals.map(professional => (
                                                <div key={professional.id} className="glass rounded-2xl p-6 card-hover">
                                                    <div className="flex flex-col md:flex-row gap-6">
                                                        <div className="flex-shrink-0">
                                                            <img 
                                                                src={professional.avatar || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face"} 
                                                                alt={professional.name}
                                                                className="w-20 h-20 rounded-full"
                                                            />
                                                        </div>
                                                        <div className="flex-1">
                                                            <div className="flex flex-col md:flex-row md:items-center justify-between mb-4">
                                                                <div>
                                                                    <h3 className="text-xl font-bold">{professional.name}</h3>
                                                                    <p className="text-gray-300">{professional.title}</p>
                                                                    <p className="text-gray-400 text-sm">{professional.company}  {professional.location}</p>
                                                                </div>
                                                                {user && user.id !== professional.id && (
                                                                    <div className="mt-4 md:mt-0">
                                                                        <button 
                                                                            onClick={() => toggleConnection(professional.id)}
                                                                            className="bg-purple-600 text-white px-6 py-2 rounded-full font-medium hover:bg-purple-700"
                                                                        >
                                                                            Connect
                                                                        </button>
                                                                    </div>
                                                                )}
                                                            </div>
                                                            
                                                            {professional.about && (
                                                                <div className="mb-4">
                                                                    <p className="text-gray-300">{professional.about}</p>
                                                                </div>
                                                            )}
                                                            
                                                            {professional.skills && (
                                                                <div className="flex flex-wrap gap-2 mb-4">
                                                                    {professional.skills.slice(0, 4).map(skill => (
                                                                        <span key={skill} className="glass px-3 py-1 rounded-full text-sm">
                                                                            {skill}
                                                                        </span>
                                                                    ))}
                                                                </div>
                                                            )}
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            <div className="lg:w-1/4">
                                <div className="glass-dark rounded-2xl p-6 mb-6">
                                    <h3 className="font-bold mb-4">Who to Follow</h3>
                                    <div className="space-y-4">
                                        {professionals.slice(0, 3).map(professional => (
                                            <div key={professional.id} className="flex items-center space-x-3">
                                                <img 
                                                    src={professional.avatar || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face"} 
                                                    alt={professional.name}
                                                    className="w-12 h-12 rounded-full"
                                                />
                                                <div className="flex-1">
                                                    <div className="font-medium">{professional.name}</div>
                                                    <div className="text-gray-400 text-sm">{professional.title}</div>
                                                </div>
                                                {user && (
                                                    <button 
                                                        onClick={() => toggleConnection(professional.id)}
                                                        className="text-purple-400 hover:text-purple-300"
                                                    >
                                                        <i className="fa-solid fa-user-plus"></i>
                                                    </button>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Events Tab
        const EventsTab = ({ events, registerForEvent, user }) => {
            const [filterCategory, setFilterCategory] = useState('All');
            const [registeredEvents, setRegisteredEvents] = useState(new Set());

            // Load user's registered events
            useEffect(() => {
                if (!user) return;
                
                const unsubscribe = db.collection('eventRegistrations')
                    .where('userId', '==', user.id)
                    .onSnapshot(snapshot => {
                        const registered = new Set();
                        snapshot.docs.forEach(doc => {
                            registered.add(doc.data().eventId);
                        });
                        setRegisteredEvents(registered);
                    });
                
                return () => unsubscribe();
            }, [user]);

            const categories = ['All', 'Conference', 'Workshop', 'Networking', 'Seminar'];

            const filteredEvents = events.filter(event => {
                const matchesCategory = filterCategory === 'All' || event.category === filterCategory;
                return matchesCategory;
            });

            const handleRegister = async (eventId) => {
                if (!user) {
                    alert("Please sign in to register for events");
                    return;
                }
                
                const success = await registerForEvent(eventId);
                if (success !== undefined) {
                    if (success) {
                        alert("Successfully registered for the event!");
                    } else {
                        alert("Successfully unregistered from the event");
                    }
                }
            };

            return (
                <div className="tab-content active fade-in">
                    <div className="container mx-auto px-6 py-8">
                        <div className="flex flex-col lg:flex-row gap-8">
                            <div className="lg:w-3/4">
                                <div className="glass-dark rounded-2xl p-6 mb-6">
                                    <h2 className="text-2xl font-bold mb-6">Professional Events</h2>
                                    
                                    <div className="mb-6">
                                        <select
                                            value={filterCategory}
                                            onChange={(e) => setFilterCategory(e.target.value)}
                                            className="w-full md:w-auto glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                        >
                                            {categories.map(category => (
                                                <option key={category} value={category}>{category}</option>
                                            ))}
                                        </select>
                                    </div>
                                    
                                    {filteredEvents.length === 0 ? (
                                        <div className="text-center py-12">
                                            <i className="fa-solid fa-calendar text-6xl text-gray-600 mb-4"></i>
                                            <p className="text-gray-400">No events found</p>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            {filteredEvents.map(event => (
                                                <div key={event.id} className="glass rounded-2xl overflow-hidden card-hover">
                                                    <div className="relative">
                                                        <img 
                                                            src={event.thumbnail} 
                                                            alt={event.title}
                                                            className="w-full h-48 object-cover"
                                                        />
                                                        <div className="absolute top-4 right-4 glass px-3 py-1 rounded-full text-sm">
                                                            {event.price === "Free" ? "Free" : event.price}
                                                        </div>
                                                    </div>
                                                    <div className="p-6">
                                                        <h3 className="text-xl font-bold mb-2">{event.title}</h3>
                                                        <div className="flex items-center space-x-4 text-sm text-gray-400 mb-4">
                                                            <span><i className="fa-solid fa-calendar mr-1"></i> {event.date}</span>
                                                            <span><i className="fa-solid fa-clock mr-1"></i> {event.time}</span>
                                                        </div>
                                                        <div className="flex items-center space-x-4 text-sm text-gray-400 mb-4">
                                                            <span><i className="fa-solid fa-location-dot mr-1"></i> {event.venue}</span>
                                                            <span><i className="fa-solid fa-users mr-1"></i> {event.attendees}</span>
                                                        </div>
                                                        <p className="text-gray-300 mb-4">{event.description}</p>
                                                        
                                                        <div className="flex items-center justify-between">
                                                            <button 
                                                                onClick={() => handleRegister(event.id)}
                                                                className={`px-4 py-2 rounded-lg font-medium ${
                                                                    registeredEvents.has(event.id)
                                                                        ? 'bg-gray-700 text-white' 
                                                                        : 'bg-purple-600 text-white hover:bg-purple-700'
                                                                }`}
                                                            >
                                                                {registeredEvents.has(event.id) ? 'Registered' : 'Register'}
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Alibaba-style Store Tab
        const StoreTab = ({ products, services, purchaseProduct, purchaseService, wallet, addFunds, user }) => {
            const [activeCategory, setActiveCategory] = useState('All');
            const [searchTerm, setSearchTerm] = useState('');
            const [showWallet, setShowWallet] = useState(false);
            const [fundAmount, setFundAmount] = useState(50);

            const categories = ['All', 'Templates', 'Software', 'E-books', 'Consulting', 'Coaching', 'Marketing'];

            const filteredProducts = products.filter(product => {
                const matchesSearch = product.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    product.description?.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = activeCategory === 'All' || product.category === activeCategory;
                
                return matchesSearch && matchesCategory;
            });

            const filteredServices = services.filter(service => {
                const matchesSearch = service.name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                    service.description?.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = activeCategory === 'All' || service.category === activeCategory;
                
                return matchesSearch && matchesCategory;
            });

            const handleAddFunds = async () => {
                const success = await addFunds(fundAmount);
                if (success) {
                    alert(`Successfully added $${fundAmount} to your wallet!`);
                    setShowWallet(false);
                } else {
                    alert("Failed to add funds. Please try again.");
                }
            };

            const handlePurchase = async (item, type) => {
                if (!user) {
                    alert("Please sign in to make purchases");
                    return;
                }

                if (wallet.balance < item.price) {
                    alert("Insufficient funds. Please add money to your wallet.");
                    return;
                }

                const success = type === 'product' 
                    ? await purchaseProduct(item.id, item.price)
                    : await purchaseService(item.id, item.price);

                if (success) {
                    alert(`Successfully purchased ${item.name}!`);
                } else {
                    alert("Purchase failed. Please try again.");
                }
            };

            return (
                <div className="tab-content active fade-in">
                    <div className="container mx-auto px-6 py-8">
                        <div className="flex items-center justify-between mb-8">
                            <h2 className="text-3xl font-bold">Professional Marketplace</h2>
                            {user && (
                                <button 
                                    onClick={() => setShowWallet(true)}
                                    className="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300 flex items-center space-x-2"
                                >
                                    <i className="fa-solid fa-wallet"></i>
                                    <span>${wallet.balance.toFixed(2)}</span>
                                </button>
                            )}
                        </div>
                        
                        <div className="glass-dark rounded-2xl p-6 mb-6">
                            <div className="flex flex-col md:flex-row gap-4 mb-6">
                                <div className="flex-1">
                                    <input
                                        type="text"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        placeholder="Search products and services..."
                                        className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    />
                                </div>
                                <div className="flex space-x-2 overflow-x-auto scrollbar-hide">
                                    {categories.map(category => (
                                        <button
                                            key={category}
                                            onClick={() => setActiveCategory(category)}
                                            className={`px-4 py-2 rounded-full whitespace-nowrap ${
                                                activeCategory === category 
                                                    ? 'bg-purple-600 text-white' 
                                                    : 'glass text-gray-300 hover:bg-white/10'
                                            }`}
                                        >
                                            {category}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="mb-8">
                                <h3 className="text-xl font-bold mb-4">Products</h3>
                                {filteredProducts.length === 0 ? (
                                    <div className="text-center py-8">
                                        <i className="fa-solid fa-box-open text-4xl text-gray-600 mb-2"></i>
                                        <p className="text-gray-400">No products found</p>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredProducts.map(product => (
                                            <div key={product.id} className="glass rounded-2xl overflow-hidden card-hover store-item">
                                                <div className="relative">
                                                    <img 
                                                        src={product.image} 
                                                        alt={product.name}
                                                        className="w-full h-48 object-cover"
                                                    />
                                                </div>
                                                <div className="p-4">
                                                    <h4 className="font-bold mb-2">{product.name}</h4>
                                                    <p className="text-gray-300 text-sm mb-4">{product.description}</p>
                                                    <div className="flex items-center justify-between">
                                                        <div className="flex items-center space-x-2">
                                                            <span className="text-lg font-bold">${product.price}</span>
                                                        </div>
                                                        <button 
                                                            onClick={() => handlePurchase(product, 'product')}
                                                            className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                                                        >
                                                            Buy Now
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            
                            <div>
                                <h3 className="text-xl font-bold mb-4">Services</h3>
                                {filteredServices.length === 0 ? (
                                    <div className="text-center py-8">
                                        <i className="fa-solid fa-handshake text-4xl text-gray-600 mb-2"></i>
                                        <p className="text-gray-400">No services found</p>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredServices.map(service => (
                                            <div key={service.id} className="glass rounded-2xl overflow-hidden card-hover store-item">
                                                <div className="relative">
                                                    <img 
                                                        src={service.image} 
                                                        alt={service.name}
                                                        className="w-full h-48 object-cover"
                                                    />
                                                </div>
                                                <div className="p-4">
                                                    <h4 className="font-bold mb-2">{service.name}</h4>
                                                    <p className="text-gray-300 text-sm mb-4">{service.description}</p>
                                                    <div className="flex items-center justify-between">
                                                        <div className="flex items-center space-x-2">
                                                            <span className="text-lg font-bold">${service.price}</span>
                                                        </div>
                                                        <button 
                                                            onClick={() => handlePurchase(service, 'service')}
                                                            className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                                                        >
                                                            Book Now
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Wallet Modal */}
                        {showWallet && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
                                <div className="glass-dark rounded-2xl p-6 w-full max-w-md go-live-modal">
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className="text-2xl font-bold gradient-text">Your Wallet</h2>
                                        <button 
                                            onClick={() => setShowWallet(false)}
                                            className="text-gray-400 hover:text-white"
                                        >
                                            <i className="fa-solid fa-times text-xl"></i>
                                        </button>
                                    </div>

                                    <div className="space-y-6">
                                        <div className="text-center">
                                            <div className="text-3xl font-bold">${wallet.balance.toFixed(2)}</div>
                                            <div className="text-gray-400">Available Balance</div>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Add Funds</label>
                                            <div className="flex space-x-2">
                                                {[10, 25, 50, 100].map(amount => (
                                                    <button
                                                        key={amount}
                                                        onClick={() => setFundAmount(amount)}
                                                        className={`flex-1 py-2 rounded-lg ${
                                                            fundAmount === amount 
                                                                ? 'bg-purple-600 text-white' 
                                                                : 'glass text-gray-300 hover:bg-white/10'
                                                        }`}
                                                    >
                                                        ${amount}
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Custom Amount</label>
                                            <input
                                                type="number"
                                                value={fundAmount}
                                                onChange={(e) => setFundAmount(parseInt(e.target.value) || 0)}
                                                className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                        </div>

                                        <div className="flex space-x-4 pt-4">
                                            <button 
                                                onClick={handleAddFunds}
                                                className="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300"
                                            >
                                                Add ${fundAmount}
                                            </button>
                                            <button 
                                                onClick={() => setShowWallet(false)}
                                                className="flex-1 glass py-3 rounded-xl font-bold hover:bg-white/10 transition-colors"
                                            >
                                                Cancel
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };
// Facebook-style Profile Tab with Profile Picture Upload
const ProfileTab = ({ user, posts, likePost, addPost, updateUserProfile, uploadMedia }) => {
    const [isEditing, setIsEditing] = useState(false);
    const [editData, setEditData] = useState({});
    const [newPost, setNewPost] = useState('');
    const [showPostModal, setShowPostModal] = useState(false);
    const [userPosts, setUserPosts] = useState([]);
    const [uploading, setUploading] = useState(false);

    // Filter posts for current user
    useEffect(() => {
        if (user && posts) {
            const userPosts = posts.filter(post => post.userId === user.id);
            setUserPosts(userPosts);
        }
    }, [user, posts]);

    useEffect(() => {
        if (user) {
            setEditData(user);
        }
    }, [user]);

    // ADD THIS FUNCTION - Profile Picture Upload
    const handleProfilePictureUpload = async (event) => {
        const file = event.target.files[0];
        if (!file) return;

        // Check file type and size
        if (!file.type.startsWith('image/')) {
            alert('Please select an image file');
            return;
        }

        if (file.size > 5 * 1024 * 1024) { // 5MB limit
            alert('Please select an image smaller than 5MB');
            return;
        }

        setUploading(true);
        try {
            // Upload to Firebase Storage
            const downloadURL = await uploadMedia(file, `profile-pictures/${user.id}`);
            
            if (downloadURL) {
                // Update user profile with new picture
                const success = await updateUserProfile({ avatar: downloadURL });
                if (success) {
                    alert('Profile picture updated successfully!');
                }
            }
        } catch (error) {
            console.error('Error uploading profile picture:', error);
            alert('Failed to upload profile picture. Please try again.');
        }
        setUploading(false);
    };

    // ADD THIS FUNCTION - Cover Photo Upload
    const handleCoverPhotoUpload = async (event) => {
        const file = event.target.files[0];
        if (!file) return;

        if (!file.type.startsWith('image/')) {
            alert('Please select an image file');
            return;
        }

        if (file.size > 5 * 1024 * 1024) {
            alert('Please select an image smaller than 5MB');
            return;
        }

        setUploading(true);
        try {
            const downloadURL = await uploadMedia(file, `cover-photos/${user.id}`);
            
            if (downloadURL) {
                const success = await updateUserProfile({ coverPhoto: downloadURL });
                if (success) {
                    alert('Cover photo updated successfully!');
                }
            }
        } catch (error) {
            console.error('Error uploading cover photo:', error);
            alert('Failed to upload cover photo. Please try again.');
        }
        setUploading(false);
    };

    const handleSaveProfile = async () => {
        const success = await updateUserProfile(editData);
        if (success) {
            setIsEditing(false);
            alert("Profile updated successfully!");
        } else {
            alert("Failed to update profile. Please try again.");
        }
    };

    const handleAddPost = async () => {
        if (newPost.trim()) {
            const success = await addPost(newPost);
            if (success) {
                setNewPost('');
                setShowPostModal(false);
                alert("Post created successfully!");
            } else {
                alert("Failed to create post. Please try again.");
            }
        }
    };

    const handleLikePost = async (post) => {
        const currentlyLiked = post.likedBy?.includes(user.id) || false;
        await likePost(post.id, currentlyLiked);
    };

    if (!user) {
        return (
            <div className="tab-content active fade-in">
                <div className="container mx-auto px-6 py-8">
                    <div className="text-center">
                        <p className="text-gray-400">Please sign in to view your profile</p>
                    </div>
                </div>
            </div>
        );
    }

    return (
        <div className="tab-content active fade-in">
            <div className="container mx-auto px-6 py-8">
                {/* Cover Photo and Profile Info - UPDATED WITH UPLOAD BUTTONS */}
                <div className="glass-dark rounded-2xl overflow-hidden mb-6">
                    <div className="relative h-64">
                        <img 
                            src={user.coverPhoto || "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&h=300&fit=crop"} 
                            alt="Cover"
                            className="w-full h-full object-cover"
                        />
                        
                        {/* ADD THIS - Cover Photo Upload Button */}
                        <div className="absolute top-4 right-4">
                            <label className="glass px-4 py-2 rounded-lg hover:bg-white/10 transition-colors cursor-pointer flex items-center space-x-2">
                                <i className="fa-solid fa-camera"></i>
                                <span>Change Cover</span>
                                <input
                                    type="file"
                                    accept="image/*"
                                    onChange={handleCoverPhotoUpload}
                                    className="hidden"
                                    disabled={uploading}
                                />
                            </label>
                        </div>

                        <div className="absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent">
                            <div className="flex flex-col md:flex-row items-start md:items-end space-y-4 md:space-y-0">
                                <div className="flex items-center space-x-4">
                                    {/* UPDATED PROFILE PICTURE WITH UPLOAD */}
                                    <div className="relative group">
                                        <img 
                                            src={user.avatar || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face"} 
                                            alt={user.name}
                                            className="w-24 h-24 rounded-full border-4 border-white"
                                        />
                                        {/* ADD THIS - Profile Picture Upload Overlay */}
                                        <label className="absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                                            <i className="fa-solid fa-camera text-white text-xl"></i>
                                            <input
                                                type="file"
                                                accept="image/*"
                                                onChange={handleProfilePictureUpload}
                                                className="hidden"
                                                disabled={uploading}
                                            />
                                        </label>
                                        {uploading && (
                                            <div className="absolute inset-0 bg-black/50 rounded-full flex items-center justify-center">
                                                <div className="loading"></div>
                                            </div>
                                        )}
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-bold">{user.name}</h1>
                                        <p className="text-gray-300">{user.title} {user.company && `at ${user.company}`}</p>
                                        <p className="text-gray-400">{user.location}</p>
                                    </div>
                                </div>
                                <div className="md:ml-auto flex space-x-3">
                                    <button 
                                        onClick={() => setShowPostModal(true)}
                                        className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                                    >
                                        <i className="fa-solid fa-pen mr-2"></i>Create Post
                                    </button>
                                    <button 
                                        onClick={() => setIsEditing(!isEditing)}
                                        className="glass px-4 py-2 rounded-lg hover:bg-white/10 transition-colors"
                                    >
                                        <i className="fa-solid fa-pencil mr-2"></i>Edit Profile
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* Rest of the component remains the same */}
                    {isEditing ? (
                        <div className="p-6">
                            <h2 className="text-xl font-bold mb-4">Edit Profile</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label className="block text-sm font-medium mb-2">Name</label>
                                    <input
                                        type="text"
                                        value={editData.name || ''}
                                        onChange={(e) => setEditData({...editData, name: e.target.value})}
                                        className="w-full glass rounded-xl py-2 px-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-2">Title</label>
                                    <input
                                        type="text"
                                        value={editData.title || ''}
                                        onChange={(e) => setEditData({...editData, title: e.target.value})}
                                        className="w-full glass rounded-xl py-2 px-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-2">Company</label>
                                    <input
                                        type="text"
                                        value={editData.company || ''}
                                        onChange={(e) => setEditData({...editData, company: e.target.value})}
                                        className="w-full glass rounded-xl py-2 px-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-2">Location</label>
                                    <input
                                        type="text"
                                        value={editData.location || ''}
                                        onChange={(e) => setEditData({...editData, location: e.target.value})}
                                        className="w-full glass rounded-xl py-2 px-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    />
                                </div>
                                <div className="md:col-span-2">
                                    <label className="block text-sm font-medium mb-2">Bio</label>
                                    <textarea
                                        value={editData.bio || ''}
                                        onChange={(e) => setEditData({...editData, bio: e.target.value})}
                                        rows="4"
                                        className="w-full glass rounded-xl py-2 px-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                    />
                                </div>
                            </div>
                            <div className="flex space-x-3">
                                <button 
                                    onClick={handleSaveProfile}
                                    className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                                >
                                    Save Changes
                                </button>
                                <button 
                                    onClick={() => setIsEditing(false)}
                                    className="glass px-4 py-2 rounded-lg hover:bg-white/10 transition-colors"
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>
                    ) : (
                        <div className="p-6">
                            {user.bio && (
                                <div className="mb-6">
                                    <h2 className="text-xl font-bold mb-2">About</h2>
                                    <p className="text-gray-300">{user.bio}</p>
                                </div>
                            )}
                        </div>
                    )}
                </div>
                
                {/* Posts Section - UPDATED WITH MEDIA UPLOAD */}
                <div className="space-y-6">
                    {userPosts.length === 0 ? (
                        <div className="text-center py-12">
                            <i className="fa-solid fa-feather-pointed text-4xl text-gray-600 mb-2"></i>
                            <p className="text-gray-400">No posts yet</p>
                            <button 
                                onClick={() => setShowPostModal(true)}
                                className="mt-4 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                            >
                                Create Your First Post
                            </button>
                        </div>
                    ) : (
                        userPosts.map(post => (
                            <div key={post.id} className="glass-dark rounded-2xl p-6">
                                <div className="flex items-start space-x-3 mb-4">
                                    <img 
                                        src={user.avatar || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face"} 
                                        alt={user.name}
                                        className="w-12 h-12 rounded-full"
                                    />
                                    <div className="flex-1">
                                        <div className="font-bold">{user.name}</div>
                                        <div className="text-gray-400 text-sm">
                                            {post.createdAt?.toDate?.().toLocaleDateString() || 'Recently'}
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="mb-4">
                                    <p>{post.content}</p>
                                    {post.mediaUrl && (
                                        <img 
                                            src={post.mediaUrl} 
                                            alt="Post media"
                                            className="mt-4 rounded-xl w-full max-h-96 object-cover"
                                        />
                                    )}
                                </div>
                                
                                <div className="flex items-center justify-between text-gray-400">
                                    <div className="flex items-center space-x-4">
                                        <button 
                                            onClick={() => handleLikePost(post)}
                                            className={`flex items-center space-x-1 ${
                                                post.likedBy?.includes(user.id) ? 'text-purple-400' : ''
                                            }`}
                                        >
                                            <i className={`fa-solid fa-thumbs-up ${
                                                post.likedBy?.includes(user.id) ? 'text-purple-400' : ''
                                            }`}></i>
                                            <span>{post.likes || 0}</span>
                                        </button>
                                        <button className="flex items-center space-x-1">
                                            <i className="fa-solid fa-comment"></i>
                                            <span>{post.comments || 0}</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))
                    )}
                </div>
            </div>

            {/* Create Post Modal - UPDATED WITH MEDIA UPLOAD */}
            {showPostModal && (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm">
                    <div className="glass-dark rounded-2xl p-6 w-full max-w-2xl go-live-modal">
                        <div className="flex items-center justify-between mb-6">
                            <h2 className="text-2xl font-bold gradient-text">Create Post</h2>
                            <button 
                                onClick={() => setShowPostModal(false)}
                                className="text-gray-400 hover:text-white"
                            >
                                <i className="fa-solid fa-times text-xl"></i>
                            </button>
                        </div>

                        <div className="space-y-4">
                            <div className="flex items-start space-x-3">
                                <img 
                                    src={user.avatar || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face"} 
                                    alt={user.name}
                                    className="w-12 h-12 rounded-full"
                                />
                                <div>
                                    <div className="font-bold">{user.name}</div>
                                    <div className="text-gray-400 text-sm">{user.title}</div>
                                </div>
                            </div>
                            
                            <div>
                                <textarea
                                    value={newPost}
                                    onChange={(e) => setNewPost(e.target.value)}
                                    placeholder="What's on your mind?"
                                    rows="5"
                                    className="w-full glass rounded-xl py-3 px-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                />
                            </div>

                            {/* ADD THIS - Media Upload in Post Creation */}
                            <div className="flex space-x-2">
                                <label className="flex items-center space-x-2 glass px-4 py-2 rounded-lg hover:bg-white/10 transition-colors cursor-pointer">
                                    <i className="fa-solid fa-image text-purple-400"></i>
                                    <span>Add Photo</span>
                                    <input
                                        type="file"
                                        accept="image/*"
                                        className="hidden"
                                        onChange={async (e) => {
                                            const file = e.target.files[0];
                                            if (file) {
                                                setUploading(true);
                                                try {
                                                    const downloadURL = await uploadMedia(file, `posts/${user.id}`);
                                                    if (downloadURL) {
                                                        // You can store this URL and attach it to the post when creating
                                                        alert('Image ready to be attached to post!');
                                                        // You would typically store this in state and attach when posting
                                                    }
                                                } catch (error) {
                                                    alert('Failed to upload image');
                                                }
                                                setUploading(false);
                                            }
                                        }}
                                    />
                                </label>
                            </div>

                            <div className="flex space-x-4 pt-4">
                                <button 
                                    onClick={handleAddPost}
                                    className="flex-1 bg-gradient-to-r from-purple-600 to-purple-700 text-white py-3 rounded-xl font-bold hover:shadow-lg transition-all duration-300"
                                >
                                    Post
                                </button>
                                <button 
                                    onClick={() => setShowPostModal(false)}
                                    className="flex-1 glass py-3 rounded-xl font-bold hover:bg-white/10 transition-colors"
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
};
        // AI Assistant Component
        const AIAssistant = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [messages, setMessages] = useState([
                { sender: 'ai', text: "Hi! I'm your M-Squared AI assistant. How can I help you today?" }
            ]);
            const [inputText, setInputText] = useState('');

            const handleSendMessage = () => {
                if (inputText.trim()) {
                    const newMessages = [...messages, { sender: 'user', text: inputText }];
                    setMessages(newMessages);
                    setInputText('');
                    
                    // Simulate AI response
                    setTimeout(() => {
                        setMessages([...newMessages, { 
                            sender: 'ai', 
                            text: "I understand your question. As an AI assistant on M-Squared, I can help you with networking tips, content suggestions, or platform guidance. For specific queries, our support team is always available!" 
                        }]);
                    }, 1000);
                }
            };

            return (
                <div className="ai-assistant">
                    {isOpen && (
                        <div className="ai-chat glass-dark rounded-2xl p-4 flex flex-col">
                            <div className="flex items-center justify-between mb-4">
                                <h3 className="font-bold">AI Assistant</h3>
                                <button 
                                    onClick={() => setIsOpen(false)}
                                    className="text-gray-400 hover:text-white"
                                >
                                    <i className="fa-solid fa-times"></i>
                                </button>
                            </div>
                            
                            <div className="flex-1 overflow-y-auto space-y-3 mb-4">
                                {messages.map((message, index) => (
                                    <div 
                                        key={index} 
                                        className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
                                    >
                                        <div 
                                            className={`max-w-[80%] rounded-xl p-3 ${
                                                message.sender === 'user' 
                                                    ? 'bg-purple-600 text-white' 
                                                    : 'glass text-gray-300'
                                            }`}
                                        >
                                            {message.text}
                                        </div>
                                    </div>
                                ))}
                            </div>
                            
                            <div className="flex space-x-2">
                                <input
                                    type="text"
                                    value={inputText}
                                    onChange={(e) => setInputText(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                                    placeholder="Type your message..."
                                    className="flex-1 glass rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                />
                                <button 
                                    onClick={handleSendMessage}
                                    className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                                >
                                    Send
                                </button>
                            </div>
                        </div>
                    )}
                    
                    <button 
                        onClick={() => setIsOpen(!isOpen)}
                        className="w-16 h-16 rounded-full bg-gradient-to-r from-purple-600 to-purple-700 text-white flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300"
                    >
                        <i className="fa-solid fa-robot text-2xl"></i>
                    </button>
                </div>
            );
        };

        // Loading Component
        const LoadingSpinner = () => (
            <div className="flex items-center justify-center h-64">
                <div className="loading"></div>
                <span className="ml-2 text-gray-400">Loading...</span>
            </div>
        );

        // Auth Required Component
        const AuthRequired = () => (
            <div className="flex items-center justify-center h-64">
                <div className="text-center">
                    <i className="fa-solid fa-lock text-4xl text-gray-600 mb-4"></i>
                    <p className="text-gray-400">Please sign in to access this feature</p>
                </div>
            </div>
        );

        // Main App Component
        const App = () => {
            const [activeTab, setActiveTab] = useState('videos');
            const dataStore = useDataStore();

            const handleSignOut = () => {
                auth.signOut().then(() => {
                    window.location.reload();
                });
            };

            if (dataStore.loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <LoadingSpinner />
                    </div>
                );
            }

            return (
                <div className="min-h-screen">
                    {/* Navigation */}
                    <nav className="glass fixed top-0 left-0 right-0 z-40">
                        <div className="container mx-auto px-6 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-2">
                                    <div className="w-10 h-10 rounded-full bg-gradient-to-r from-purple-600 to-purple-700 flex items-center justify-center">
                                        <span className="font-bold text-white">M</span>
                                    </div>
                                    <span className="text-xl font-bold gradient-text">M-Squared</span>
                                </div>
                                
                                <div className="flex-1 max-w-2xl mx-6">
                                    <div className="relative">
                                        <input
                                            type="text"
                                            placeholder="Search professionals, content, events..."
                                            className="w-full glass rounded-xl py-3 px-4 pl-12 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                        />
                                        <i className="fa-solid fa-magnifying-glass absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                                    </div>
                                </div>
                                
                                <div className="flex items-center space-x-4">
                                    {dataStore.user ? (
                                        <>
                                            <div className="hidden md:flex items-center space-x-4">
                                                <button className="glass px-4 py-2 rounded-lg hover:bg-white/10 transition-colors">
                                                    <i className="fa-solid fa-bell"></i>
                                                </button>
                                                <button className="glass px-4 py-2 rounded-lg hover:bg-white/10 transition-colors">
                                                    <i className="fa-solid fa-envelope"></i>
                                                </button>
                                            </div>
                                            <div className="flex items-center space-x-3">
                                                <img 
                                                    src={dataStore.user.avatar || "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=100&h=100&fit=crop&crop=face"} 
                                                    alt={dataStore.user.name}
                                                    className="w-10 h-10 rounded-full"
                                                />
                                                <span className="hidden md:block font-medium">{dataStore.user.name}</span>
                                                <button 
                                                    onClick={handleSignOut}
                                                    className="glass px-3 py-1 rounded-lg hover:bg-white/10 transition-colors text-sm"
                                                >
                                                    Sign Out
                                                </button>
                                            </div>
                                        </>
                                    ) : (
                                        <button 
                                            onClick={init3DAuth}
                                            className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"
                                        >
                                            Sign In
                                        </button>
                                    )}
                                </div>
                            </div>
                            
                            {/* Tab Navigation */}
                            <div className="flex space-x-1 mt-4 overflow-x-auto scrollbar-hide">
                                {[
                                    { id: 'videos', label: 'Videos', icon: 'fa-solid fa-play' },
                                    { id: 'live', label: 'Live', icon: 'fa-solid fa-broadcast-tower' },
                                    { id: 'network', label: 'Network', icon: 'fa-solid fa-user-group' },
                                    { id: 'events', label: 'Events', icon: 'fa-solid fa-calendar' },
                                    { id: 'store', label: 'Store', icon: 'fa-solid fa-store' },
                                    { id: 'profile', label: 'Profile', icon: 'fa-solid fa-user' }
                                ].map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center space-x-2 px-4 py-3 rounded-xl whitespace-nowrap ${
                                            activeTab === tab.id 
                                                ? 'bg-purple-600 text-white' 
                                                : 'text-gray-300 hover:bg-white/10'
                                        }`}
                                    >
                                        <i className={tab.icon}></i>
                                        <span>{tab.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>
                    
                    {/* Main Content */}
                    <main className="pt-32 pb-20">
                        {activeTab === 'videos' && (
                            dataStore.user ? (
                                <VideosTab 
                                    videos={dataStore.videos} 
                                    likeVideo={dataStore.likeVideo}
                                    addComment={dataStore.addComment}
                                    user={dataStore.user}
                                    uploadMedia={dataStore.uploadMedia}
                                />
                            ) : <AuthRequired />
                        )}
                        
                        {activeTab === 'live' && (
                            dataStore.user ? (
                                <LiveTab 
                                    liveStreams={dataStore.liveStreams}
                                    createLiveStream={dataStore.createLiveStream}
                                    user={dataStore.user}
                                    addChatMessage={dataStore.addChatMessage}
                                />
                            ) : <AuthRequired />
                        )}
                        
                        {activeTab === 'network' && (
                            <NetworkTab 
                                professionals={dataStore.professionals}
                                toggleConnection={dataStore.toggleConnection}
                                user={dataStore.user}
                            />
                        )}
                        
                        {activeTab === 'events' && (
                            <EventsTab 
                                events={dataStore.events}
                                registerForEvent={dataStore.registerForEvent}
                                user={dataStore.user}
                            />
                        )}
                        
                        {activeTab === 'store' && (
                            <StoreTab 
                                products={dataStore.products}
                                services={dataStore.services}
                                purchaseProduct={dataStore.purchaseProduct}
                                purchaseService={dataStore.purchaseService}
                                wallet={dataStore.wallet}
                                addFunds={dataStore.addFunds}
                                user={dataStore.user}
                            />
                        )}
                        
                        {activeTab === 'profile' && (
                            <ProfileTab 
                                user={dataStore.user}
                                posts={dataStore.posts}
                                likePost={dataStore.likePost}
                                addPost={dataStore.addPost}
                                updateUserProfile={dataStore.updateUserProfile}
                                 uploadMedia={dataStore.uploadMedia}
                            />
                        )}
                    </main>
                    
                    {/* AI Assistant */}
                    {dataStore.user && <AIAssistant />}
                </div>
            );
        };

        // Render the App
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
